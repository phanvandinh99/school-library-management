@model IEnumerable<SchoolLibrary.Web.Models.BorrowRecord>
@{
    ViewData["Title"] = "M∆∞·ª£n/Tr·∫£ S√°ch";
}

<div class="content-box">
    <h2 class="mb-4">üìã M∆∞·ª£n/Tr·∫£ S√°ch</h2>

    <div class="mb-3 d-flex justify-content-between align-items-center">
        <a asp-action="Borrow" class="btn btn-success">
            ‚ûï M∆∞·ª£n s√°ch m·ªõi
        </a>
        <div>
            <a asp-action="Index" asp-route-status="" class="btn btn-sm @(ViewBag.Status == null ? "btn-primary" : "btn-outline-primary")">T·∫•t c·∫£</a>
            <a asp-action="Index" asp-route-status="active" class="btn btn-sm @(ViewBag.Status == "active" ? "btn-primary" : "btn-outline-primary")">ƒêang m∆∞·ª£n</a>
            <a asp-action="Index" asp-route-status="returned" class="btn btn-sm @(ViewBag.Status == "returned" ? "btn-primary" : "btn-outline-primary")">ƒê√£ tr·∫£</a>
            <a asp-action="Index" asp-route-status="overdue" class="btn btn-sm @(ViewBag.Status == "overdue" ? "btn-primary" : "btn-outline-primary")">Qu√° h·∫°n</a>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Ng∆∞·ªùi m∆∞·ª£n</th>
                    <th>S√°ch</th>
                    <th>M√£ b·∫£n sao</th>
                    <th>Ng√†y m∆∞·ª£n</th>
                    <th>H·∫°n tr·∫£</th>
                    <th>Ng√†y tr·∫£</th>
                    <th>Ph·∫°t</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var borrow in Model)
                {
                    <tr>
                        <td>@borrow.BorrowID</td>
                        <td>@borrow.User?.FullName</td>
                        <td>@borrow.BookCopy?.Book?.Title</td>
                        <td>@borrow.BookCopy?.CopyCode</td>
                        <td>@borrow.BorrowDate.ToString("dd/MM/yyyy")</td>
                        <td>@borrow.DueDate.ToString("dd/MM/yyyy")</td>
                        <td>@(borrow.ReturnDate?.ToString("dd/MM/yyyy") ?? "-")</td>
                        <td>
                            @if (borrow.FineAmount > 0)
                            {
                                <span class="badge bg-danger">@borrow.FineAmount.ToString("N0") VNƒê</span>
                            }
                            else
                            {
                                <span class="badge bg-success">0 VNƒê</span>
                            }
                        </td>
                        <td>
                            @if (borrow.IsReturned)
                            {
                                <span class="badge bg-success">ƒê√£ tr·∫£</span>
                            }
                            else if (borrow.DueDate < DateTime.Now.Date)
                            {
                                <span class="badge bg-danger">Qu√° h·∫°n</span>
                            }
                            else
                            {
                                <span class="badge bg-warning">ƒêang m∆∞·ª£n</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Details" asp-route-id="@borrow.BorrowID" class="btn btn-sm btn-info">Chi ti·∫øt</a>
                            @if (!borrow.IsReturned)
                            {
                                <form asp-action="Return" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@borrow.BorrowID" />
                                    <button type="submit" class="btn btn-sm btn-success" onclick="return confirm('X√°c nh·∫≠n tr·∫£ s√°ch?');">Tr·∫£</button>
                                </form>
                                <form asp-action="Renew" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@borrow.BorrowID" />
                                    <button type="submit" class="btn btn-sm btn-warning" onclick="return confirm('X√°c nh·∫≠n gia h·∫°n?');">Gia h·∫°n</button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

