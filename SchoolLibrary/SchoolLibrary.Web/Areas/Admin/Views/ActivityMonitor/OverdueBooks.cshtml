@model IEnumerable<SchoolLibrary.Web.Models.BorrowRecord>
@{
    ViewData["Title"] = "S√°ch Qu√° H·∫°n";
}

<div class="content-box">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">‚ö†Ô∏è S√°ch Qu√° H·∫°n Ch∆∞a Tr·∫£</h2>
        <a asp-action="Index" class="btn btn-secondary">‚Üê Quay l·∫°i</a>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-success">
            <h5>‚úì Tuy·ªát v·ªùi!</h5>
            <p>Kh√¥ng c√≥ s√°ch n√†o qu√° h·∫°n.</p>
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <h5>‚ö†Ô∏è C√≥ @Model.Count() s√°ch qu√° h·∫°n ch∆∞a ƒë∆∞·ª£c tr·∫£</h5>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-danger">
                    <tr>
                        <th>Ng√†y m∆∞·ª£n</th>
                        <th>H·∫°n tr·∫£</th>
                        <th>S·ªë ng√†y qu√° h·∫°n</th>
                        <th>Ng∆∞·ªùi m∆∞·ª£n</th>
                        <th>T√™n s√°ch</th>
                        <th>M√£ s√°ch</th>
                        <th>Ti·ªÅn ph·∫°t</th>
                        <th>Li√™n h·ªá</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var record in Model)
                    {
                        var daysOverdue = (DateTime.Now.Date - record.DueDate.Date).Days;
                        var fineAmount = daysOverdue * 5000; // 5000 VND per day
                        
                        <tr>
                            <td>@record.BorrowDate.ToString("dd/MM/yyyy")</td>
                            <td>@record.DueDate.ToString("dd/MM/yyyy")</td>
                            <td>
                                <span class="badge bg-danger">@daysOverdue ng√†y</span>
                            </td>
                            <td>
                                @record.User?.FullName<br>
                                <small class="text-muted">@record.User?.Email</small>
                            </td>
                            <td>@record.BookCopy?.Book?.Title</td>
                            <td>@record.BookCopy?.CopyCode</td>
                            <td class="text-danger">
                                <strong>@fineAmount.ToString("#,##0") ‚Ç´</strong>
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(record.User?.Phone))
                                {
                                    <a href="tel:@record.User.Phone" class="btn btn-sm btn-primary">üìû G·ªçi</a>
                                }
                                @if (!string.IsNullOrEmpty(record.User?.Email))
                                {
                                    <a href="mailto:@record.User.Email" class="btn btn-sm btn-info">‚úâÔ∏è Email</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>


